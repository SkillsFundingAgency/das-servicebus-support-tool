@using Microsoft.AspNetCore.Http
@model MessageListViewModel

@section Scripts
{
    <script src="~/lib/bootstrap-table/bootstrap-table.min.js"></script>

   <script>

        let baseUrl = "@(Url.Action("Index", "MessageDetails"))";

        function operateFormatter(value, row, index) {
            return '<a class="detail" href=' + (baseUrl + "/?id=" + row.id) +' title ="Detail">Detail</a>';
        };

    </script>
}

@section Styles
{
    <link rel="stylesheet" href="lib/bootstrap-table/bootstrap-table.min.css"/>
}

<div>
    <h3 class="display-5"> @Model.QueueInfo.Name</h3>
    <div>
        <div>Investigating: @Model.Count </div>
        <div>On the queue: @Model.QueueInfo.MessageCount </div>
    </div>

    <div>
        <a asp-controller="MessageList" asp-action="ReceiveMessages" asp-route-queue="@Model.QueueInfo.Name" onclick="displayBusyIndicator()">Get More Messages</a> |

        <a asp-controller="MessageList" asp-action="AbortMessages" onclick="displayBusyIndicator()">Abort</a> |
        <a asp-controller="MessageList" asp-action="EndSession" onclick="displayBusyIndicator()">End Session</a>

    </div>
    
    <table
        id="table"
        data-toggle="table"
        data-pagination="true"
        data-search="true"
        data-click-to-select="true"
        data-sortable="true"
        data-side-pagination="server"
        data-url="@Url.Action("data", "MessageList")"
        style="table-layout: fixed">
        <thead>
        <tr>
            <th scope="col"
                class="col-wrap"
                data-field="id"
                data-visible="false"
            >
            </th>
            <th scope="col"
                class="col-wrap"
                data-field="state"
                data-checkbox="true"
                data-width="5"
                data-width-unit="%">
            </th>
            <th scope="col"
                class="col-wrap"
                data-sortable="true"
                data-field="originatingEndpoint"
                data-width="10"
                data-width-unit="%">
                Originating Endpoint
            </th>
            <th scope="col"
                class="col-wrap"
                data-sortable="true"
                data-field="processingEndpoint"
                data-width="10"
                data-width-unit="%">
                Processing Endpoint
            </th>
            <th scope="col"
                class="col-wrap"
                data-sortable="false"
                data-field="body"
                data-width="25"
                data-width-unit="%">
                Body
            </th>
            <th scope="col"
                class="col-wrap"
                data-sortable="false"
                data-field="exception"
                data-width="25"
                data-width-unit="%">
                Exception
            </th>
            <th scope="col"
                class="col-wrap"
                data-sortable="true"
                data-field="exceptionType"
                data-width="10"
                data-width-unit="%">
                Exception Type
            </th>
            <th scope="col"
                class="col-wrap"
                data-sortable="false"
                data-width="10"
                data-width-unit="%"
                data-formatter="operateFormatter">
                Actions
            </th>
        </tr>
        </thead>
    </table>
</div>